basePath: /api/v1
definitions:
  app.Response:
    properties:
      code:
        type: integer
      data: {}
      msg:
        type: string
    type: object
  handler.AccessTokenResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
    type: object
  handler.ApplyCouponReq:
    properties:
      coupon_id:
        type: integer
    type: object
  handler.CreateProductReq:
    properties:
      end_time:
        description: 可选，结束时间，不设置则永不过期
        example: "2025-12-10 12:00:00"
        type: string
      image:
        example: https://example.com/shoe.jpg
        type: string
      name:
        example: 限量球鞋
        type: string
      price:
        example: 999
        type: number
      start_time:
        example: "2025-12-10 10:00:00"
        type: string
      stock:
        example: 100
        type: integer
    required:
    - name
    - price
    - start_time
    - stock
    type: object
  handler.IDResponse:
    properties:
      id:
        type: integer
    type: object
  handler.MessageResponse:
    properties:
      message:
        type: string
    type: object
  handler.OrderListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/model.Order'
        type: array
      page:
        type: integer
      size:
        type: integer
      total:
        type: integer
    type: object
  handler.OrderWithPaymentResponse:
    properties:
      coupon:
        $ref: '#/definitions/service.MyCoupon'
      order:
        $ref: '#/definitions/model.Order'
      payment:
        $ref: '#/definitions/handler.PaymentResponse'
    type: object
  handler.PaymentCallbackReq:
    properties:
      notify_data:
        type: string
      payment_id:
        type: string
      status:
        description: paid / failed / refunded
        type: string
    required:
    - payment_id
    - status
    type: object
  handler.PaymentResponse:
    properties:
      CreatedAt:
        type: string
      ID:
        type: integer
      UpdatedAt:
        type: string
      amount_cents:
        type: integer
      notify_data:
        type: string
      order_id:
        type: integer
      payment_id:
        type: string
      status:
        $ref: '#/definitions/model.PaymentStatus'
    type: object
  handler.PollOrderResponse:
    properties:
      message:
        type: string
      order:
        $ref: '#/definitions/service.OrderWithPayment'
      order_num:
        type: string
      payment_id:
        type: string
      status:
        type: string
    type: object
  handler.ProductListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/model.Product'
        type: array
      page:
        type: integer
      total:
        type: integer
    type: object
  handler.ProductListWithSizeResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/model.Product'
        type: array
      page:
        type: integer
      size:
        type: integer
      total:
        type: integer
    type: object
  handler.PurchaseCouponReq:
    properties:
      coupon_id:
        type: integer
    required:
    - coupon_id
    type: object
  handler.PurchaseVIPReq:
    properties:
      plan_id:
        type: integer
    required:
    - plan_id
    type: object
  handler.RefreshReq:
    properties:
      refresh_token:
        type: string
    required:
    - refresh_token
    type: object
  handler.RegisterReq:
    properties:
      user_name:
        type: string
      user_password:
        type: string
    required:
    - user_name
    - user_password
    type: object
  handler.SeckillReq:
    properties:
      product_id:
        type: integer
    required:
    - product_id
    type: object
  handler.SeckillResponse:
    properties:
      order_id:
        type: integer
      order_num:
        type: string
      payment_id:
        type: string
      status:
        type: string
    type: object
  handler.TokenPairResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
      refresh_token:
        type: string
    type: object
  handler.UpdateProductReq:
    properties:
      end_time:
        description: 可选，结束时间，空字符串清除
        example: "2025-12-10 12:00:00"
        type: string
      image:
        example: https://example.com/shoe.jpg
        type: string
      name:
        example: 限量球鞋
        type: string
      price:
        example: 999
        type: number
      start_time:
        example: "2025-12-10 10:00:00"
        type: string
      stock:
        example: 100
        type: integer
    type: object
  handler.UpdateProfileReq:
    properties:
      avatar:
        type: string
      user_name:
        maxLength: 50
        minLength: 1
        type: string
    type: object
  handler.UploadURLResponse:
    properties:
      url:
        type: string
    type: object
  handler.UserResponse:
    properties:
      CreatedAt:
        type: string
      ID:
        type: integer
      UpdatedAt:
        type: string
      avatar:
        type: string
      balance:
        type: number
      username:
        type: string
    type: object
  model.CouponStatus:
    enum:
    - available
    - used
    - expired
    type: string
    x-enum-varnames:
    - CouponStatusAvailable
    - CouponStatusUsed
    - CouponStatusExpired
  model.CouponType:
    enum:
    - full_cut
    - discount
    type: string
    x-enum-comments:
      CouponTypeDiscount: 折扣
      CouponTypeFullCut: 满减
    x-enum-descriptions:
    - 满减
    - 折扣
    x-enum-varnames:
    - CouponTypeFullCut
    - CouponTypeDiscount
  model.Order:
    properties:
      created_at:
        type: string
      id:
        type: integer
      order_num:
        type: string
      product_id:
        type: integer
      status:
        $ref: '#/definitions/model.OrderStatus'
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  model.OrderStatus:
    enum:
    - 0
    - 1
    - 2
    type: integer
    x-enum-varnames:
    - OrderStatusUnpaid
    - OrderStatusPaid
    - OrderStatusFailed
  model.Payment:
    properties:
      amount_cents:
        type: integer
      created_at:
        type: string
      deleted_at:
        type: string
      id:
        type: integer
      notify_data:
        type: string
      order_id:
        type: integer
      payment_id:
        type: string
      status:
        $ref: '#/definitions/model.PaymentStatus'
      updated_at:
        type: string
    type: object
  model.PaymentStatus:
    enum:
    - pending
    - paid
    - failed
    - refunded
    type: string
    x-enum-varnames:
    - PaymentStatusPending
    - PaymentStatusPaid
    - PaymentStatusFailed
    - PaymentStatusRefunded
  model.Product:
    properties:
      created_at:
        type: string
      end_time:
        description: 可选，NULL 表示永不过期
        type: string
      id:
        type: integer
      image:
        type: string
      name:
        type: string
      price:
        type: number
      start_time:
        type: string
      stock:
        type: integer
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  service.MyCoupon:
    properties:
      amount_cents:
        description: 满减金额（分）
        type: integer
      coupon_id:
        description: 券模板 ID
        type: integer
      description:
        type: string
      discount_rate:
        description: 折扣率，如 90 表示九折
        type: integer
      id:
        description: 用户券 ID
        type: integer
      min_spend_cents:
        description: 使用门槛（分）
        type: integer
      obtained_from:
        description: purchase/vip_month
        type: string
      status:
        $ref: '#/definitions/model.CouponStatus'
      title:
        type: string
      type:
        allOf:
        - $ref: '#/definitions/model.CouponType'
        description: full_cut/discount
      valid_from:
        type: string
      valid_to:
        type: string
    type: object
  service.OrderWithPayment:
    properties:
      coupon:
        $ref: '#/definitions/service.MyCoupon'
      order:
        $ref: '#/definitions/model.Order'
      payment:
        $ref: '#/definitions/model.Payment'
    type: object
  service.VIPProfile:
    properties:
      effective_level:
        description: 生效等级 = max(成长, 付费)
        type: integer
      growth_level:
        description: 成长等级（消费累计）
        type: integer
      paid_expired_at:
        description: 付费到期时间
        type: string
      paid_level:
        description: 付费等级
        type: integer
      total_spent_cents:
        description: 累计消费（分）
        type: integer
    type: object
info:
  contact: {}
  description: SneakerFlash 球鞋秒杀系统接口文档
  title: SneakerFlash API
  version: "1.0"
paths:
  /coupons/mine:
    get:
      parameters:
      - description: available/used/expired
        in: query
        name: status
        type: string
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 20
        description: 每页数量
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/service.MyCoupon'
                  type: array
              type: object
      security:
      - BearerAuth: []
      summary: 我的优惠券
      tags:
      - Coupon
  /coupons/purchase:
    post:
      consumes:
      - application/json
      parameters:
      - description: coupon_id
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.PurchaseCouponReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/service.MyCoupon'
              type: object
      security:
      - BearerAuth: []
      summary: 购买优惠券（模拟支付）
      tags:
      - Coupon
  /login:
    post:
      consumes:
      - application/json
      description: 登录后下发 access/refresh token
      parameters:
      - description: 登录信息
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.TokenPairResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 认证失败
          schema:
            $ref: '#/definitions/app.Response'
      summary: 用户登录
      tags:
      - 用户
  /orders:
    get:
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页条数
        in: query
        name: page_size
        type: integer
      - description: 订单状态：0未支付 1已支付 2失败
        in: query
        name: status
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderListResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 查询订单列表
      tags:
      - 订单
  /orders/{id}:
    get:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.PollOrderResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 获取订单详情
      tags:
      - 订单
  /orders/{id}/apply-coupon:
    post:
      consumes:
      - application/json
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      - description: 优惠券参数，coupon_id 为空表示不使用优惠券
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.ApplyCouponReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderWithPaymentResponse'
              type: object
        "400":
          description: 参数错误或状态不允许
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 订单不存在
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 订单应用优惠券
      tags:
      - 订单
  /orders/poll/{order_num}:
    get:
      parameters:
      - description: 订单号
        in: path
        name: order_num
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderWithPaymentResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 轮询订单创建状态
      tags:
      - 订单
  /payment/callback:
    post:
      consumes:
      - application/json
      parameters:
      - description: 支付回调参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.PaymentCallbackReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderWithPaymentResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 支付单不存在
          schema:
            $ref: '#/definitions/app.Response'
      summary: 支付回调
      tags:
      - 订单
  /product/{id}:
    get:
      parameters:
      - description: 商品ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/model.Product'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      summary: 获取商品详情
      tags:
      - 商品
  /products:
    get:
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页条数
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.ProductListResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
      summary: 获取商品列表
      tags:
      - 商品
    post:
      consumes:
      - application/json
      parameters:
      - description: 商品参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.CreateProductReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/model.Product'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 发布商品
      tags:
      - 商品
  /products/{id}:
    delete:
      parameters:
      - description: 商品ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.IDResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 删除商品
      tags:
      - 商品
    put:
      consumes:
      - application/json
      parameters:
      - description: 商品ID
        in: path
        name: id
        required: true
        type: integer
      - description: 商品参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateProductReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.IDResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 更新商品
      tags:
      - 商品
  /products/mine:
    get:
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页条数
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.ProductListWithSizeResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 我的商品列表
      tags:
      - 商品
  /profile:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.UserResponse'
              type: object
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 获取当前用户信息
      tags:
      - 用户
    put:
      consumes:
      - application/json
      parameters:
      - description: 支持部分字段
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateProfileReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.UserResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 更新当前用户信息
      tags:
      - 用户
  /refresh:
    post:
      consumes:
      - application/json
      description: 使用 refresh_token 刷新新的 access_token
      parameters:
      - description: 刷新参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.RefreshReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.AccessTokenResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: token 失效
          schema:
            $ref: '#/definitions/app.Response'
      summary: 刷新 access token
      tags:
      - 用户
  /register:
    post:
      consumes:
      - application/json
      description: 注册后返回成功提示
      parameters:
      - description: 注册信息
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.MessageResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
      summary: 用户注册
      tags:
      - 用户
  /seckill:
    post:
      consumes:
      - application/json
      parameters:
      - description: 秒杀参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.SeckillReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.SeckillResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "429":
          description: 被限流
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 秒杀抢购
      tags:
      - 秒杀
  /upload:
    post:
      consumes:
      - multipart/form-data
      parameters:
      - description: 图片文件
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.UploadURLResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 上传图片
      tags:
      - 文件
  /vip/profile:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/service.VIPProfile'
              type: object
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 获取 VIP 信息
      tags:
      - VIP
  /vip/purchase:
    post:
      consumes:
      - application/json
      parameters:
      - description: 付费套餐
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.PurchaseVIPReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/service.VIPProfile'
              type: object
        "400":
          description: 参数错误或套餐不存在
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 购买付费 VIP
      tags:
      - VIP
schemes:
- http
securityDefinitions:
  BearerAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
