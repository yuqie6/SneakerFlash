basePath: /api/v1
definitions:
  app.Response:
    properties:
      code:
        type: integer
      data: {}
      msg:
        type: string
    type: object
  handler.AccessTokenResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
    type: object
  handler.CreateOrderReq:
    properties:
      product_id:
        type: integer
    required:
    - product_id
    type: object
  handler.CreateProductReq:
    properties:
      image:
        type: string
      name:
        type: string
      price:
        type: number
      start_time:
        type: string
      stock:
        type: integer
    required:
    - name
    - price
    - start_time
    - stock
    type: object
  handler.IDResponse:
    properties:
      id:
        type: integer
    type: object
  handler.MessageResponse:
    properties:
      message:
        type: string
    type: object
  handler.OrderListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/model.Order'
        type: array
      page:
        type: integer
      size:
        type: integer
      total:
        type: integer
    type: object
  handler.OrderNumResponse:
    properties:
      order_num:
        type: string
    type: object
  handler.OrderWithPaymentResponse:
    properties:
      order:
        $ref: '#/definitions/model.Order'
      payment:
        $ref: '#/definitions/handler.PaymentResponse'
    type: object
  handler.PaymentCallbackReq:
    properties:
      notify_data:
        type: string
      payment_id:
        type: string
      status:
        description: paid / failed / refunded
        type: string
    required:
    - payment_id
    - status
    type: object
  handler.PaymentResponse:
    properties:
      CreatedAt:
        type: string
      ID:
        type: integer
      UpdatedAt:
        type: string
      amount_cents:
        type: integer
      notify_data:
        type: string
      order_id:
        type: integer
      payment_id:
        type: string
      status:
        $ref: '#/definitions/model.PaymentStatus'
    type: object
  handler.ProductListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/model.Product'
        type: array
      page:
        type: integer
      total:
        type: integer
    type: object
  handler.ProductListWithSizeResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/model.Product'
        type: array
      page:
        type: integer
      size:
        type: integer
      total:
        type: integer
    type: object
  handler.RefreshReq:
    properties:
      refresh_token:
        type: string
    required:
    - refresh_token
    type: object
  handler.RegisterReq:
    properties:
      user_name:
        type: string
      user_password:
        type: string
    required:
    - user_name
    - user_password
    type: object
  handler.SeckillReq:
    properties:
      product_id:
        type: integer
    required:
    - product_id
    type: object
  handler.TokenPairResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
      refresh_token:
        type: string
    type: object
  handler.UpdateProductReq:
    properties:
      image:
        type: string
      name:
        type: string
      price:
        type: number
      start_time:
        type: string
      stock:
        type: integer
    type: object
  handler.UpdateProfileReq:
    properties:
      avatar:
        type: string
      user_name:
        maxLength: 50
        minLength: 1
        type: string
    type: object
  handler.UploadURLResponse:
    properties:
      url:
        type: string
    type: object
  handler.UserResponse:
    properties:
      CreatedAt:
        type: string
      ID:
        type: integer
      UpdatedAt:
        type: string
      avatar:
        type: string
      balance:
        type: number
      username:
        type: string
    type: object
  model.Order:
    properties:
      created_at:
        type: string
      id:
        type: integer
      order_num:
        type: string
      product_id:
        type: integer
      status:
        $ref: '#/definitions/model.OrderStatus'
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  model.OrderStatus:
    enum:
    - 0
    - 1
    - 2
    type: integer
    x-enum-varnames:
    - OrderStatusUnpaid
    - OrderStatusPaid
    - OrderStatusFailed
  model.PaymentStatus:
    enum:
    - pending
    - paid
    - failed
    - refunded
    type: string
    x-enum-varnames:
    - PaymentStatusPending
    - PaymentStatusPaid
    - PaymentStatusFailed
    - PaymentStatusRefunded
  model.Product:
    properties:
      created_at:
        type: string
      id:
        type: integer
      image:
        type: string
      name:
        type: string
      price:
        type: number
      start_time:
        type: string
      stock:
        type: integer
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
info:
  contact: {}
  description: SneakerFlash 球鞋秒杀系统接口文档
  title: SneakerFlash API
  version: "1.0"
paths:
  /login:
    post:
      consumes:
      - application/json
      description: 登录后下发 access/refresh token
      parameters:
      - description: 登录信息
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.TokenPairResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 认证失败
          schema:
            $ref: '#/definitions/app.Response'
      summary: 用户登录
      tags:
      - 用户
  /orders:
    get:
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页条数
        in: query
        name: size
        type: integer
      - description: 订单状态：0未支付 1已支付 2失败
        in: query
        name: status
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderListResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 查询订单列表
      tags:
      - 订单
    post:
      consumes:
      - application/json
      parameters:
      - description: 订单参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.CreateOrderReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderWithPaymentResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 商品不存在
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 创建订单并初始化支付
      tags:
      - 订单
  /orders/{id}:
    get:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderWithPaymentResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 获取订单详情
      tags:
      - 订单
  /payment/callback:
    post:
      consumes:
      - application/json
      parameters:
      - description: 支付回调参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.PaymentCallbackReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderWithPaymentResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 支付单不存在
          schema:
            $ref: '#/definitions/app.Response'
      summary: 支付回调
      tags:
      - 订单
  /product/{id}:
    get:
      parameters:
      - description: 商品ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/model.Product'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      summary: 获取商品详情
      tags:
      - 商品
  /products:
    get:
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页条数
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.ProductListResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
      summary: 获取商品列表
      tags:
      - 商品
    post:
      consumes:
      - application/json
      parameters:
      - description: 商品参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.CreateProductReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/model.Product'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 发布商品
      tags:
      - 商品
  /products/{id}:
    delete:
      parameters:
      - description: 商品ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.IDResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 删除商品
      tags:
      - 商品
    put:
      consumes:
      - application/json
      parameters:
      - description: 商品ID
        in: path
        name: id
        required: true
        type: integer
      - description: 商品参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateProductReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.IDResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "404":
          description: 未找到
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 更新商品
      tags:
      - 商品
  /products/mine:
    get:
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页条数
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.ProductListWithSizeResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 我的商品列表
      tags:
      - 商品
  /profile:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.UserResponse'
              type: object
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 获取当前用户信息
      tags:
      - 用户
    put:
      consumes:
      - application/json
      parameters:
      - description: 支持部分字段
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateProfileReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.UserResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 更新当前用户信息
      tags:
      - 用户
  /refresh:
    post:
      consumes:
      - application/json
      description: 使用 refresh_token 刷新新的 access_token
      parameters:
      - description: 刷新参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.RefreshReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.AccessTokenResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: token 失效
          schema:
            $ref: '#/definitions/app.Response'
      summary: 刷新 access token
      tags:
      - 用户
  /register:
    post:
      consumes:
      - application/json
      description: 注册后返回成功提示
      parameters:
      - description: 注册信息
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.MessageResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
      summary: 用户注册
      tags:
      - 用户
  /seckill:
    post:
      consumes:
      - application/json
      parameters:
      - description: 秒杀参数
        in: body
        name: payload
        required: true
        schema:
          $ref: '#/definitions/handler.SeckillReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.OrderNumResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
        "429":
          description: 被限流
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 秒杀抢购
      tags:
      - 秒杀
  /upload:
    post:
      consumes:
      - multipart/form-data
      parameters:
      - description: 图片文件
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/app.Response'
            - properties:
                data:
                  $ref: '#/definitions/handler.UploadURLResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/app.Response'
        "401":
          description: 未登录
          schema:
            $ref: '#/definitions/app.Response'
      security:
      - BearerAuth: []
      summary: 上传图片
      tags:
      - 文件
schemes:
- http
securityDefinitions:
  BearerAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
